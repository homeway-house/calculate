<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Homeway(é´»ç·¯)è³£æ–¹å°ˆæ¥­ä¼°åƒ¹ç³»çµ±</title>
    <style>
        :root { --primary: #2c3e50; --accent: #E74C3C; --old-mode: #2980b9; --bg: #f0f2f5; --card-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        body { font-family: -apple-system, "Noto Sans TC", sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }
        .header { background: linear-gradient(135deg, #2c3e50, #4ca1af); color: white; text-align: center; padding: 20px 0; }
        .header h1 { margin: 0; font-size: 1.3em; letter-spacing: 1px; }
        .tabs { display: flex; background: white; border-bottom: 1px solid #e0e0e0; position: sticky; top: 0; z-index: 100; }
        .tab { flex: 1; text-align: center; padding: 15px; cursor: pointer; color: #95a5a6; font-weight: bold; font-size: 0.9em; }
        .tab.active { color: var(--accent); border-bottom: 3px solid var(--accent); }
        .tab.old-active { color: var(--old-mode); border-bottom: 3px solid var(--old-mode); }
        .container { padding: 15px; max-width: 500px; margin: auto; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: var(--card-shadow); margin-bottom: 25px; }
        .content { display: none; }
        .content.active { display: block; animation: fadeIn 0.5s ease; }
        label { display: block; margin-top: 15px; font-size: 0.85em; color: var(--primary); font-weight: bold; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border: 1.5px solid #eee; border-radius: 10px; font-size: 16px; box-sizing: border-box; background: #fdfdfd; }
        .mode-switch { display: flex; gap: 8px; margin-bottom: 10px; background: #f0f2f5; padding: 5px; border-radius: 10px; }
        .mode-btn { flex: 1; text-align: center; padding: 10px; border-radius: 8px; cursor: pointer; font-size: 0.8em; font-weight: bold; color: #7f8c8d; }
        .mode-btn.selected { background: white; color: var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .switch-container { display: flex; align-items: center; justify-content: space-between; background: #f8f9fa; padding: 12px; border-radius: 10px; margin-top: 15px; border: 1px solid #eee; }
        .toggle { position: relative; display: inline-block; width: 44px; height: 22px; }
        .toggle input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(22px); }
        .btn-main { width: 100%; color: white; padding: 16px; border: none; border-radius: 12px; font-size: 1.1em; margin-top: 25px; font-weight: bold; cursor: pointer; }
        .btn-new { background: linear-gradient(135deg, #E74C3C, #C0392B); }
        .btn-old { background: linear-gradient(135deg, #2980b9, #2c3e50); }
        .result-box { padding: 25px; border-radius: 18px; margin-top: 25px; color: white; display: none; background: #2c3e50; animation: slideUp 0.4s ease; }
        .res-price { text-align: center; font-size: 2.5em; font-weight: bold; margin: 10px 0; color: #F1C40F; }
        .row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 0.9em; }
        .disclaimer { font-size: 0.7em; color: rgba(255,255,255,0.6); margin-top: 15px; line-height: 1.4; text-align: justify; }
        .copy-btn { width: 100%; background: rgba(255,255,255,0.1); color: white; padding: 10px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; margin-top: 15px; cursor: pointer; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(15px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

<div class="header">
    <h1>ğŸ  Homeway(é´»ç·¯)è³£æ–¹å°ˆæ¥­ä¼°åƒ¹</h1>
</div>

<div class="tabs">
    <div id="t_new" class="tab active" onclick="switchTab(event, 'newSystem')">æˆ¿åœ°åˆä¸€ (æ–°åˆ¶)</div>
    <div id="t_old" class="tab" onclick="switchTab(event, 'oldSystem')">è³‡æ·±è³‡ç”¢ (èˆŠåˆ¶)</div>
</div>

<div class="container">
    <div id="newSystem" class="content active">
        <div class="card">
            <div class="mode-switch">
                <div id="n_rev" class="mode-btn selected" onclick="setMode('n', 'reverse')">ğŸ”„ å¯¦æ‹¿é€†æ¨</div>
                <div id="n_for" class="mode-btn" onclick="setMode('n', 'forward')">ğŸ“ˆ å”®åƒ¹è©¦ç®—</div>
            </div>
            <label id="n_label">ğŸ’° ç›®æ¨™å¯¦æ‹¿é‡‘é¡ (è¬)</label>
            <input type="number" id="n_val" value="1000">
            <label>ğŸ“‰ åŸå§‹å–å¾—æˆæœ¬ (è¬)</label>
            <input type="number" id="n_cost" value="666">
            <div style="display:flex; gap:10px;">
                <div style="flex:1;"><label>é›œè²»+åœŸå¢ç¨… (è¬)</label><input type="number" id="n_misc" value="40"></div>
                <div style="flex:1;"><label>ä»²ä»‹è²» (%)</label><input type="number" id="n_agentP" value="4"></div>
            </div>
            <label>æŒæœ‰æ—¥æœŸåˆ¤å®š</label>
            <div style="display:flex; gap:10px;">
                <input type="date" id="n_buyDate">
                <input type="date" id="n_sellDate">
            </div>
            <div class="switch-container">
                <div style="font-size:0.85em;">ç¬¦åˆ<b>ã€Œè‡ªä½æ»¿ 6 å¹´ã€</b>å„ªæƒ ï¼Ÿ</div>
                <label class="toggle"><input type="checkbox" id="n_selfUse"><span class="slider"></span></label>
            </div>
            <button class="btn-main btn-new" onclick="calcNew()">å•Ÿå‹•ç™¼è²¡ä¼°åƒ¹ ğŸš€</button>
            <div id="res_new" class="result-box">
                <div id="n_res_title" style="text-align:center; font-size:0.8em; opacity:0.8;">å»ºè­°æˆäº¤ç¸½åƒ¹</div>
                <div class="res-price" id="o_n_price">0 è¬</div>
                <div class="row"><span>ğŸ“ é©ç”¨ç¨…åˆ¶ï¼š</span><span id="o_n_taxLabel" style="color:#F1C40F;">--</span></div>
                <div class="row"><span>ğŸ’¸ é ä¼°æˆ¿åœ°åˆä¸€ç¨…ï¼š</span><span id="o_n_tax">0 è¬</span></div>
                <div class="row"><span>ğŸ¤ é ä¼°ä»²ä»‹è²»ï¼š</span><span id="o_n_agent">0 è¬</span></div>
                <div class="disclaimer">â€» æœ¬å ±å‘Šä¾æˆ¿åœ°åˆä¸€ç¨…åˆ¶è©¦ç®—ï¼Œå¯¦éš›æ‡‰ç´ç¨…é¡åŠè²»ç”¨ä»¥åœ‹ç¨…å±€æ ¸å®šåŠå¯¦éš›åˆç´„ç‚ºæº–ã€‚</div>
                <button class="copy-btn" onclick="copyText('new')">ğŸ“‹ è¤‡è£½å°ˆæ¥­å ±å‘Š</button>
            </div>
        </div>
    </div>

    <div id="oldSystem" class="content">
        <div class="card">
            <div class="mode-switch">
                <div id="o_rev" class="mode-btn selected" onclick="setMode('o', 'reverse')">ğŸ”„ å¯¦æ‹¿é€†æ¨</div>
                <div id="o_for" class="mode-btn" onclick="setMode('o', 'forward')">ğŸ“ˆ å”®åƒ¹è©¦ç®—</div>
            </div>
            <label id="o_label">ğŸ’° ç›®æ¨™å¯¦æ‹¿é‡‘é¡ (è¬)</label>
            <input type="number" id="o_val" value="2000">
            <label>ğŸ  æˆ¿å±‹è©•å®šç¾å€¼ (è¬)</label>
            <input type="number" id="o_houseV" value="100">
            <label>ğŸ‘¤ å€‹äººé è¨ˆæ‰€å¾—ç¨…ç‡</label>
            <select id="o_userRate">
                <option value="0.05">5% (å¹´æ‰€å¾—ç´„ 56è¬ä»¥ä¸‹)</option>
                <option value="0.12">12% (å¹´æ‰€å¾—ç´„ 56~126è¬)</option>
                <option value="0.20" selected>20% (å¹´æ‰€å¾—ç´„ 126~252è¬)</option>
                <option value="0.30">30% (å¹´æ‰€å¾—ç´„ 252~472è¬)</option>
                <option value="0.40">40% (å¹´æ‰€å¾—ç´„ 472è¬ä»¥ä¸Š)</option>
            </select>
            <div style="display:flex; gap:10px;">
                <div style="flex:1;"><label>ğŸ”¥ åœŸå¢ç¨…é ä¼° (è¬)</label><input type="number" id="o_landTax" value="120"></div>
                <div style="flex:1;"><label>ğŸ¤ ä»²ä»‹è²»ç‡ (%)</label><input type="number" id="o_agentP" value="4"></div>
            </div>
            <button class="btn-main btn-old" onclick="calcOld()">å•Ÿå‹•å°ˆæ¥­ä¼°åƒ¹ ğŸš€</button>
            <div id="res_old" class="result-box">
                <div id="o_res_title" style="text-align:center; font-size:0.8em; opacity:0.8;">å»ºè­°æˆäº¤ç¸½åƒ¹</div>
                <div class="res-price" id="o_o_price">0 è¬</div>
                <div class="row"><span>ğŸ“ é ä¼°è²¡äº¤ç¨…(èˆŠåˆ¶)ï¼š</span><span id="o_o_tax" style="color:#F1C40F;">0 è¬</span></div>
                <div class="row"><span>ğŸ”¥ åœŸåœ°å¢å€¼ç¨…ï¼š</span><span id="o_o_land">0 è¬</span></div>
                <div class="row"><span>ğŸ¤ é ä¼°ä»²ä»‹è²»ï¼š</span><span id="o_o_agent">0 è¬</span></div>
                <div class="disclaimer">â€» èˆŠåˆ¶æ‰€å¾—ç¨…å°‡ä½µå…¥å€‹äººç¶œæ‰€ç¨…æ–¼éš”å¹´ 5 æœˆç”³å ±ã€‚æœ¬è©¦ç®—åƒ…ä¾›è¦åŠƒåƒè€ƒï¼Œå¯¦éš›ç¨…é¡ä¾å ±ç¨…ç‹€æ³ç‚ºæº–ã€‚</div>
                <button class="copy-btn" onclick="copyText('old')">ğŸ“‹ è¤‡è£½å°ˆæ¥­å ±å‘Š</button>
            </div>
        </div>
    </div>
</div>

<script>
    function switchTab(evt, name) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active', 'old-active'));
        document.getElementById(name).classList.add('active');
        evt.currentTarget.classList.add(name === 'oldSystem' ? 'old-active' : 'active');
    }
    function setMode(p, m) {
        document.getElementById(p+'_rev').classList.toggle('selected', m==='reverse');
        document.getElementById(p+'_for').classList.toggle('selected', m==='forward');
        document.getElementById(p+'_label').innerText = m==='reverse' ? 'ç›®æ¨™å¯¦æ‹¿é‡‘é¡ (è¬)' : 'é è¨ˆæˆäº¤ç¸½åƒ¹ (è¬)';
    }

    function calcNew() {
        const mode = document.getElementById('n_rev').classList.contains('selected') ? 'reverse' : 'forward';
        const val = parseFloat(document.getElementById('n_val').value)*10000, cost = parseFloat(document.getElementById('n_cost').value)*10000;
        const misc = parseFloat(document.getElementById('n_misc').value)*10000, ar = parseFloat(document.getElementById('n_agentP').value)/100;
        const start = new Date(document.getElementById('n_buyDate').value), end = new Date(document.getElementById('n_sellDate').value);
        const yrs = (end - start)/(31557600000), isSelf = document.getElementById('n_selfUse').checked;
        let tr = 0.2, exemp = 0, tName = "20% (5-10å¹´)";
        if(isSelf && yrs >= 6) { tr = 0.1; exemp = 4000000; tName = "10% (è‡ªä½æ»¿6å¹´)"; }
        else if(yrs < 2) { tr = 0.45; tName = "45% (2å¹´å…§)"; } else if(yrs < 5) { tr = 0.35; tName = "35% (2-5å¹´)"; } else if(yrs >= 10) { tr = 0.15; tName = "15% (10å¹´ä»¥ä¸Š)"; }

        let listP = val, tax = 0, ag = 0;
        if(mode === 'forward') { ag = listP * ar; tax = Math.max(0, listP - cost - misc - exemp) * tr; 
            document.getElementById('o_n_price').innerText = ((listP - ag - misc - tax)/10000).toFixed(1) + " è¬";
            document.getElementById('n_res_title').innerText = "æ‰£é™¤ç¨…è²»å¾Œï¼Œé è¨ˆå¯¦æ‹¿é‡‘é¡";
        } else {
            for(let i=0; i<50; i++) { ag = listP * ar; tax = Math.max(0, (listP - cost - misc) - exemp) * tr;
                let diff = val - (listP - ag - misc - tax); if(Math.abs(diff)<100) break; listP += diff;
            }
            document.getElementById('o_n_price').innerText = (listP/10000).toFixed(1) + " è¬";
            document.getElementById('n_res_title').innerText = "ç‚ºé”æˆç›®æ¨™ï¼Œå»ºè­°æˆäº¤åº•åƒ¹";
        }
        document.getElementById('o_n_taxLabel').innerText = tName;
        document.getElementById('o_n_tax').innerText = (tax/10000).toFixed(1) + " è¬";
        document.getElementById('o_n_agent').innerText = (ag/10000).toFixed(1) + " è¬";
        document.getElementById('res_new').style.display = 'block';
    }

    function calcOld() {
        const mode = document.getElementById('o_rev').classList.contains('selected') ? 'reverse' : 'forward';
        const val = parseFloat(document.getElementById('o_val').value)*10000, hV = parseFloat(document.getElementById('o_houseV').value)*10000;
        const lT = parseFloat(document.getElementById('o_landTax').value)*10000, ar = parseFloat(document.getElementById('o_agentP').value)/100;
        const uR = parseFloat(document.getElementById('o_userRate').value);
        const tax = (hV * 0.30) * uR; // å‡è¨­åœ°å€æ ¸å®šæ¯”ä¾‹ 30%

        let listP = 0, ag = 0;
        if(mode === 'forward') { listP = val; ag = listP * ar;
            document.getElementById('o_o_price').innerText = ((listP - ag - lT - tax)/10000).toFixed(1) + " è¬";
            document.getElementById('o_res_title').innerText = "æ‰£é™¤ç¨…è²»å¾Œï¼Œé è¨ˆå¯¦æ‹¿é‡‘é¡";
        } else {
            listP = (val + tax + lT) / (1 - ar); ag = listP * ar;
            document.getElementById('o_o_price').innerText = (listP/10000).toFixed(1) + " è¬";
            document.getElementById('o_res_title').innerText = "ç‚ºé”æˆç›®æ¨™ï¼Œå»ºè­°æˆäº¤åº•åƒ¹";
        }
        document.getElementById('o_o_tax').innerText = (tax/10000).toFixed(1) + " è¬";
        document.getElementById('o_o_land').innerText = (lT/10000).toFixed(1) + " è¬";
        document.getElementById('o_o_agent').innerText = (ag/10000).toFixed(1) + " è¬";
        document.getElementById('res_old').style.display = 'block';
    }

    function copyText(type) {
        const price = (type==='new') ? document.getElementById('o_n_price').innerText : document.getElementById('o_o_price').innerText;
        const text = `ã€Homeway(é´»ç·¯)è³£æ–¹å°ˆæ¥­ä¼°åƒ¹ã€‘\næˆäº¤ä¼°è¨ˆï¼š${price}\n---\nâ€» è©¦ç®—çµæœåƒ…ä¾›è¦åŠƒåƒè€ƒï¼Œä»¥åœ‹ç¨…å±€æ­£å¼æ ¸å®šç‚ºæº–ã€‚`;
        navigator.clipboard.writeText(text).then(() => alert("å ±å‘Šå·²è¤‡è£½ï¼"));
    }

    window.onload = function() {
        let d = new Date(); document.getElementById('n_sellDate').valueAsDate = d;
        let p = new Date(); p.setFullYear(d.getFullYear()-6); document.getElementById('n_buyDate').valueAsDate = p;
    }
</script>
</body>
</html>
